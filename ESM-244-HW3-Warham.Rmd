---
title: "ESM-244-HW3-Warham"
author: "Matthew Warham"
date: "March 1, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

###Task 2: Truckee River Flow (2000-2016)

##Part a. Time Series Graph

```{r}

#install.packages("tseries")
#install.packages("forecast")
#install.packages("dplyr")
#install.packages("haven")
#install.packages("stringi")
library(tidyverse)

library(forecast)
library(tseries)

truckee <- read_csv("truckee_flow_clean.csv")

View(truckee)

```

```{r}

truckee_ts <- ts(truckee$`Monthly Mean Value`, frequency = 12, start = c(2000,1))

truckee_ts

plot(truckee_ts)

```


# Decomposed ts
```{r}

truckee_dc <- decompose(truckee_ts)
plot(truckee_dc)

```

# This data does not appear to be additive or multiplicative. This data appears to be stationary because the mean of the trend data seems to be stationary over time. There is definite seasonality in the data, as the water flow peaks once every year probably after the snow melt in spring. There is somewhat of a cyclical trend every 5 or so years.

## Part b: Holt Winters


```{r}

truckee_hw <- HoltWinters(truckee_ts)
truckee_hw
plot(truckee_hw)

truckee_forecast <- forecast(truckee_hw, h = 60)
plot(truckee_forecast,
     main = "Average Water Flow",
     xlab = "Year",
     ylab = "Monthly Mean Flow (cubic feet per second)")

```

#Figure 1: Monthly Mean Flow of the Truckee River (2000-2016). Time series data showing water flow in cubic feet per second. A Holt Winters function was used to forecast river flow from 2015 to 2020, and is shown with higher and lower bounds seen in the shaded areas. 

##Residuals

```{r}

hist(truckee_forecast$residuals)

```


###Task 3: Mapping California's National Parks

```{r}


library(sf)
library(tmap)
library(leaflet)
library(ggplot2)
library(sp)
library(ggrepel)
library(ggspatial)
library(RColorBrewer)
library(raster)

ca_counties <- read_sf(".", layer = "california_county_shape_file")
st_crs(ca_counties) = 4326
plot(ca_counties)

View(ca_counties)

ca_parks <- read_sf(".", layer = "nps_boundary (1)") %>% 
  dplyr::filter(STATE == "CA") %>% 
  dplyr::filter(UNIT_TYPE == "National Park")

st_crs(ca_parks) = 4326
 
View(ca_parks)
  
plot(ca_parks)

np_coords <- do.call(rbind, st_geometry(ca_parks)) %>% 
    as_tibble() %>% setNames(c("lon","lat"))

View(np_coords)

ca_geom <- st_geometry(ca_parks$geometry)
View(ca_geom)

color_count <- 7
mycolors <- colorRampPalette(brewer.pal(10, "Set2"))(color_count)

ggplot(ca_parks)+
  scale_fill_manual(values = mycolors)+
  geom_sf(data = ca_counties, fill = "lightskyblue1")+
  geom_sf(aes(fill = UNIT_TYPE),
              color = "red",
              show.legend = FALSE)
  #geom_text
              #st_centroid(st_geometry(ca_parks$geometry), add = TRUE)) +
  #st_coordinates()+
  #st_centroid((ca_parks), add = TRUE, col = "red")+
  #geom_label_repel(aes(x = lon, y = lat, label = UNIT_NAME))+
  theme_light()
      






```

