---
title: "ESM-244-HW3-Warham"
author: "Matthew Warham"
date: "March 1, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

###Task 2: Truckee River Flow (2000-2016)

##Part a. Time Series Graph

```{r}

#install.packages("tseries")
#install.packages("forecast")
#install.packages("dplyr")
#install.packages("haven")
#install.packages("stringi")
library(tidyverse)

library(forecast)
library(tseries)

truckee <- read_csv("truckee_flow_clean.csv")

View(truckee)

```

```{r}

truckee_ts <- ts(truckee$`Monthly Mean Value`, frequency = 12, start = c(2000,1))

truckee_ts

plot(truckee_ts)

```


# Decomposed ts
```{r}

truckee_dc <- decompose(truckee_ts)
plot(truckee_dc)

```

# This data does not appear to be additive or multiplicative. This data appears to be stationary because the mean of the trend data seems to be stationary over time. There is definite seasonality in the data, as the water flow peaks once every year probably after the snow melt in spring. There is somewhat of a cyclical trend every 5 or so years.

## Part b: Holt Winters


```{r}

truckee_hw <- HoltWinters(truckee_ts)
truckee_hw
plot(truckee_hw)

truckee_forecast <- forecast(truckee_hw, h = 60)
plot(truckee_forecast,
     main = "Average Water Flow",
     xlab = "Year",
     ylab = "Monthly Mean Flow (cubic feet per second)")

```

#Figure 1: Monthly Mean Flow of the Truckee River (2000-2016). Time series data showing water flow in cubic feet per second. A Holt Winters function was used to forecast river flow from 2015 to 2020, and is shown with higher and lower bounds seen in the shaded areas. 

##Residuals

```{r}

hist(truckee_forecast$residuals)

```


###Task 3: Mapping California's National Parks

```{r}


library(sf)
library(tmap)
library(leaflet)
library(ggplot2)
library(sp)
library(ggrepel)
library(ggspatial)
library(RColorBrewer)
library(raster)

ca_counties <- read_sf(".", layer = "california_county_shape_file")
st_crs(ca_counties) = 4326
plot(ca_counties)


View(ca_counties)



ca_parks <- read_sf(".", layer = "nps_boundary") %>% 
  dplyr::filter(STATE == "CA") %>% 
  dplyr::filter(UNIT_TYPE == "National Park") %>% 
  mutate(lon=map_dbl(geometry, ~st_centroid(.x)[[1]]),
         lat=map_dbl(geometry, ~st_centroid(.x)[[2]]))

st_crs(ca_parks) = 4326

 
View(ca_parks)
  
plot(ca_parks)

np_coords <- do.call(rbind, st_geometry(ca_parks)) %>% 
    as_tibble() %>% setNames(c("lon","lat"))

View(np_coords)

ca_geom <- st_geometry(ca_parks$geometry)
View(ca_geom)



color_count <- 9
mycolors <- colorRampPalette(brewer.pal(10, "Dark2"))(color_count)


ggplot(ca_counties)+
  geom_sf(fill = "azure1",
          color = "gray30",
          size = 0.1) +
  geom_sf(data = ca_parks, 
          aes(fill = UNIT_NAME),
          color = "NA",
          show.legend = FALSE)+
  geom_label_repel(data = ca_parks, aes(x=lon, y = lat, label = UNIT_NAME),
                   box.padding = 1,
                   #force = 1,
                  point.padding = 0.75,
                  alpha = 0.75,
                  fontface = 'bold', 
                  color = 'black')+
  scale_fill_manual(values = mycolors) +
  theme(panel.grid.major = element_line(color = "transparent"), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        axis.line = element_blank())+
  ggtitle("California National Parks")

  #geom_text
              #st_centroid(st_geometry(ca_parks$geometry), add = TRUE)) +
  #st_coordinates()+
  #st_centroid((ca_parks), add = TRUE, col = "red")+
  #geom_label_repel(aes(x = lon, y = lat, label = UNIT_NAME))+
  
    






```

###Task 4: Lizards

```{r}

library(ggplot2)
library(pwr)
library(effsize)


## Data wrangling 

lizard <- read_csv("lter_lizard_pitfall.csv") %>% 
  dplyr::filter(Site == "CALI") %>% 
  dplyr::filter(Sex %in% c("M", "F")) %>% 
  dplyr::filter(Weight != ".") %>% 
  dplyr::filter(TailBreak != ".")

View(lizard)

Male <- lizard %>%
  filter(Sex == "M") %>% 
  dplyr::select(Weight)

M <- Male$Weight %>% 
as.numeric(Male$Weight)

class(M)

View(M)



Female <- lizard %>% 
  filter(Sex == "F") %>% 
  dplyr::select(Weight)

Fe <- Female$Weight %>% 
  as.numeric(Female$Weight)

class(Fe)

View(Fe)

par(mfrow = c(2,2))
hist(M)
qqnorm(M)
hist(Fe)
qqnorm(Fe)

## T test
  

t_test <- t.test(M, Fe)
t_test

# According the two sample t test, the average weight of males was 5.09 grams (n=55) and the average weight of females was 5.82 grams (n= 75). Mean weights are not significantly different t(123) = -0.6825, p value = 0.4962 

## Chi Sq test for tail breaks

tab1 <- table(lizard$Sex, lizard$TailBreak)
tab1

prop.table(tab1)

tails <- lizard %>% 
  dplyr::select(c("Sex", "TailBreak")) 

View(tails)
  
  

chisq <- chisq.test(tails)
chisq

# There is not a significant difference in proportions chisq(1) = 0.16319, p value = 0.6862

male_broken <- 10/55 #0.182
female_broken <- 17/75 #0.223

#Proportions of broken tails
#Males = 10/55
#Females = 17/75

#No significant proportion of males (0.182) and females (0.23) with broken tails

```

